var v=r=>{throw TypeError(r)};var A=(r,t,n)=>t.has(r)||v("Cannot "+n);var d=(r,t,n)=>(A(r,t,"read from private field"),n?n.call(r):t.get(r)),p=(r,t,n)=>t.has(r)?v("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,n),y=(r,t,n,e)=>(A(r,t,"write to private field"),e?e.call(r,n):t.set(r,n),n);import{s as j,f as k,m as $,u as O}from"./index-BXFXDHjK.js";function E(r,t=/{{(.*?)}}/){let n=t.exec(r);const e=[];let s;for(;n;)s=n.index,s!==0&&(e.push({match:!1,str:r.substring(0,s)}),r=r.slice(s)),e.push({match:!0,str:n[0]}),r=r.slice(n[0].length),n=t.exec(r);return r&&e.push({match:!1,str:r}),e}function U(r){const t=r.match(/(?<fname>[A-Z_][A-Z_1-9]*)\((?<args>[^)]+)\)/i);if(!(t!=null&&t.groups))return;const{fname:n,args:e}=t.groups,s=Object.fromEntries(e.split(",").map(f=>{var a;const{key:i,num:o,str:c}=((a=f.match(/(?<key>[a-z_0-9]*)\s*=\s*((?<num>[0-9.]+)|('|")(?<str>.*)('|"))/i))==null?void 0:a.groups)??{};if(!i||!(o||c))throw Error(`Failed to match fn kwarg: ${f}`);return[i,o?Number(o):c]}));return{fname:n,ctx:s}}const x="abcdefghijklmnopqrstuvwxyz",_="01234569789",z="()*/+-",M=" ",Z=new Set(x+x.toUpperCase()+_+z+M);function F(r){for(let t=0;t<r.length;t++)if(!Z.has(r.charAt(t)))return;return E(r,/[A-Za-z_][A-Za-z0-9_]*/gi)}function I(r,t){return E(r).map(e=>{if(!e.match)return e.str;let s=e.str.split(/{{|}}/).filter(Boolean)[0].trim();if(s in t)return t[s];const f=U(s);if(f){const{fname:o,ctx:c}=f,a=t[o];if(typeof a=="function")return a(c);throw Error(`Cannot find function named ${o} in rendering context.`)}const i=F(s);if(i){const o=i.map(c=>{if(!c.match)return c.str;const a=t[c.str];if(a==null)throw Error(`Cannot find number named ${c.str} in rendering context.`);if(typeof a!="number")throw Error(`The provided value for ${c.str} must be a number.`);return a});return Function('"use strict";return ('+o.join("")+")")()}throw new Error(`Unable to match ${e.str}`)}).join("")}function N(r,t=I){return"version"in r?S(r,t):P(r)}function P(r){return new Map(Object.entries(r))}function S(r,t){var f;const n={};for(const[i,o]of Object.entries(r.templates??{}))o.includes("{{")?n[i]=c=>t(o,c):n[i]=o;const e=(i,o)=>t(i,{...n,...o}),s=new Map;for(const[i,o]of Object.entries(r.refs??{}))if(typeof o=="string")s.set(i,o);else{const c=(f=o[0])!=null&&f.includes("{{")?e(o[0]):o[0];s.set(i,o.length===1?[c]:[c,o[1],o[2]])}for(const i of r.gen??[])for(const o of T(i.dimensions)){const c=e(i.key,o),a=e(i.url,o);if("offset"in i&&"length"in i){const w=e(i.offset,o),C=e(i.length,o);s.set(c,[a,parseInt(w),parseInt(C)])}else s.set(c,[a])}return s}function*T(r){const t=Object.keys(r),n=Object.values(r).map(e=>Array.isArray(e)?e:[...B(e)]);for(const e of q(...n))yield Object.fromEntries(t.map((s,f)=>[s,e[f]]))}function*q(...r){if(r.length===0)return;const t=r.map(e=>e[Symbol.iterator]()),n=t.map(e=>e.next());if(n.some(e=>e.done))throw new Error("Input contains an empty iterator.");for(let e=0;;){if(n[e].done){if(t[e]=r[e][Symbol.iterator](),n[e]=t[e].next(),++e>=t.length)return}else yield n.map(({value:s})=>s),e=0;n[e]=t[e].next()}}function*B({stop:r,start:t=0,step:n=1}){for(let e=t;e<r;e+=n)yield e}(()=>{for(var r=new Uint8Array(128),t=0;t<64;t++)r[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;return n=>{for(var e=n.length,s=new Uint8Array((e-(n[e-1]=="=")-(n[e-2]=="="))*3/4|0),f=0,i=0;f<e;){var o=r[n.charCodeAt(f++)],c=r[n.charCodeAt(f++)],a=r[n.charCodeAt(f++)],w=r[n.charCodeAt(f++)];s[i++]=o<<2|c>>4,s[i++]=c<<4|a>>2,s[i++]=a<<6|w}return s}})();new TextEncoder;let u=new Uint8Array(128);for(let r=0;r<64;r++)u[r<26?r+65:r<52?r+71:r<62?r-4:r*4-205]=r;function V(r){const t=r.length,n=new Uint8Array((t-(r[t-1]==="=")-(r[t-2]==="="))*3/4|0);for(let e=0,s=0;e<t;){const f=u[r.charCodeAt(e++)],i=u[r.charCodeAt(e++)],o=u[r.charCodeAt(e++)],c=u[r.charCodeAt(e++)];n[s++]=f<<2|i>>4,n[s++]=i<<4|o>>2,n[s++]=o<<6|c}return n}var l,h,m;const g=class g{constructor(t,n={}){p(this,l);p(this,h);p(this,m);y(this,l,Promise.resolve(t)),y(this,h,n),y(this,m,n.overrides||{})}async get(t,n={}){let e=(await d(this,l)).get(j(t));if(!e)return;if(typeof e=="string")return e.startsWith("base64:")?V(e.slice(7)):new TextEncoder().encode(e);let[s,f,i]=e,o=s??d(this,h).target;if(!o)throw Error(`No url for key ${t}, and no target url provided.`);let c=await k(O(o),f,i,$(d(this,m),n));if(c.status===200||c.status===206)return new Uint8Array(await c.arrayBuffer());throw new Error(`Request unsuccessful for key ${t}. Response status: ${c.status}.`)}static fromSpec(t,n){let e=Promise.resolve(t).then(s=>N(s));return new g(e,n)}static fromUrl(t,n){let e=fetch(t,n==null?void 0:n.overrides).then(s=>s.json());return g.fromSpec(e,n)}};l=new WeakMap,h=new WeakMap,m=new WeakMap;let b=g;export{b as default,V as to_binary};
